<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CondomAI - Gestione Intelligente Condominiale</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CustomGPT Integration -->
    <script defer src="https://cdn.customgpt.ai/js/chat.js"></script>
    
    <style>
        :root {
            --primary-black: #1a1a1a;
            --primary-gold: #d4af37;
            --primary-white: #ffffff;
            --secondary-gold: #b8860b;
            --dark-gray: #2d2d2d;
            --light-gray: #f5f5f5;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary-black) 0%, var(--dark-gray) 100%);
            min-height: 100vh;
            color: var(--primary-white);
        }
        
        .gold-gradient {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--secondary-gold) 100%);
        }
        
        .glass-effect {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .chat-message-user {
            background: var(--primary-gold);
            color: var(--primary-black);
        }
        
        .chat-message-ai {
            background: rgba(26, 26, 26, 0.9);
            color: var(--primary-white);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #10b981;
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .notification.info {
            background: var(--primary-gold);
            color: var(--primary-black);
        }
        
        .sidebar-item:hover {
            background: rgba(212, 175, 55, 0.1);
            transform: translateX(5px);
            transition: all 0.3s ease;
        }
        
        .sidebar-item.active {
            background: var(--primary-gold);
            color: var(--primary-black);
        }
        
        .document-card {
            transition: all 0.3s ease;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.2);
            border-color: var(--primary-gold);
        }
        
        .search-highlight {
            background: rgba(212, 175, 55, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--primary-gold);
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-gold {
            animation: pulseGold 2s infinite;
        }
        
        @keyframes pulseGold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            50% { box-shadow: 0 0 20px 10px rgba(212, 175, 55, 0); }
        }

        .customgpt-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .customgpt-connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .customgpt-disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .upload-zone {
            border: 2px dashed rgba(212, 175, 55, 0.5);
            transition: all 0.3s ease;
        }

        .upload-zone.dragover {
            border-color: var(--primary-gold);
            background: rgba(212, 175, 55, 0.1);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-gold) !important;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .btn-primary {
            background: var(--primary-gold);
            color: var(--primary-black);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--secondary-gold);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary-gold);
            border: 2px solid var(--primary-gold);
            padding: 10px 22px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--primary-gold);
            color: var(--primary-black);
        }

        .stats-card {
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gold);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-gold);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* CustomGPT Chat Integration Styles */
        .customgpt-container {
            width: 100%;
            height: 100%;
            border-radius: 12px;
            overflow: hidden;
        }

        .customgpt-fallback {
            display: none;
        }

        .customgpt-active .customgpt-fallback {
            display: none;
        }

        .customgpt-active .customgpt-container {
            display: block;
        }

        #customGptWidget {
            width: 100%;
            height: 500px;
            border: none;
            background: transparent;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="glass-effect shadow-lg fixed w-full top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 gold-gradient rounded-lg flex items-center justify-center">
                        <i class="fas fa-building text-black text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">CondomAI</h1>
                        <p class="text-sm text-gray-300">Gestione Intelligente Condominiale</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="customgpt-status" id="customGptStatus">
                        <span class="w-2 h-2 rounded-full mr-2" id="statusDot"></span>
                        <span id="statusText">Connessione in corso...</span>
                    </div>
                    <div class="relative">
                        <i class="fas fa-bell text-white hover:text-yellow-400 cursor-pointer text-xl" id="notificationBell"></i>
                        <span id="notificationBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center">
                            <span id="userInitials" class="text-black font-semibold text-sm">U</span>
                        </div>
                        <div class="text-white">
                            <p id="userName" class="font-medium">Utente</p>
                            <p id="userRole" class="text-xs text-gray-300">Condomino</p>
                        </div>
                    </div>
                    <button id="logoutBtn" class="text-white hover:text-yellow-400 transition">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 fade-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 gold-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-building text-black text-2xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">CondomAI</h2>
                <p class="text-gray-300">Accedi alla piattaforma</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Email/Username</label>
                    <input type="text" id="loginUsername" class="w-full px-4 py-3 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none transition" placeholder="Inserisci email o username" required>
                </div>
                <div>
                    <label class="block text-white text-sm font-medium mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none transition" placeholder="Inserisci password" required>
                </div>
                <div class="flex items-center justify-between">
                    <label class="flex items-center text-sm text-gray-300">
                        <input type="checkbox" class="mr-2" id="rememberMe">
                        Ricordami
                    </label>
                    <a href="#" class="text-yellow-400 hover:text-yellow-300 text-sm">Password dimenticata?</a>
                </div>
                <button type="submit" class="w-full btn-primary pulse-gold">
                    Accedi
                </button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-400 text-sm">Account demo:</p>
                <p class="text-gray-300 text-xs">admin@condominio.it / admin123 (Amministratore)</p>
                <p class="text-gray-300 text-xs">mario.rossi@email.it / mario123 (Condomino)</p>
            </div>
        </div>
    </div>

    <div class="flex min-h-screen pt-20">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 glass-effect shadow-xl fixed h-full">
            <nav class="p-6 mt-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" class="sidebar-item flex items-center space-x-3 text-white hover:text-yellow-400 p-3 rounded-lg transition" data-section="dashboard">
                            <i class="fas fa-tachometer-alt w-5"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center space-x-3 text-white hover:text-yellow-400 p-3 rounded-lg transition" data-section="documents">
                            <i class="fas fa-folder w-5"></i>
                            <span>Documenti</span>
                            <span class="ml-auto bg-gold text-black text-xs rounded-full px-2 py-1">19</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center space-x-3 text-white hover:text-yellow-400 p-3 rounded-lg transition" data-section="chat">
                            <i class="fas fa-comments w-5"></i>
                            <span>Chat AI</span>
                            <span id="unreadMessages" class="ml-auto bg-red-500 text-white text-xs rounded-full px-2 py-1 hidden">0</span>
                        </a>
                    </li>
                    <li id="adminMenuItem" class="hidden">
                        <a href="#" class="sidebar-item flex items-center space-x-3 text-white hover:text-yellow-400 p-3 rounded-lg transition" data-section="admin">
                            <i class="fas fa-cog w-5"></i>
                            <span>Amministrazione</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center space-x-3 text-white hover:text-yellow-400 p-3 rounded-lg transition" data-section="search">
                            <i class="fas fa-search w-5"></i>
                            <span>Ricerca Avanzata</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="sidebar-item flex items-center space-x-3 text-white hover:text-yellow-400 p-3 rounded-lg transition" data-section="settings">
                            <i class="fas fa-user-cog w-5"></i>
                            <span>Impostazioni</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 ml-64 p-6">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Dashboard</h2>
                    <p class="text-gray-300">Panoramica delle attività condominiali</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Documenti Totali</p>
                                <p class="text-2xl font-bold text-white" id="totalDocuments">19</p>
                            </div>
                            <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-alt text-black"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Chat Attive</p>
                                <p class="text-2xl font-bold text-white" id="activeChats">3</p>
                            </div>
                            <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-comments text-black"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Utenti Online</p>
                                <p class="text-2xl font-bold text-white" id="onlineUsers">5</p>
                            </div>
                            <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-users text-black"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Stato CustomGPT</p>
                                <p class="text-sm font-medium text-green-400" id="customGptDashboardStatus">Connesso</p>
                            </div>
                            <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-robot text-black"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Attività Recenti</h3>
                        <div class="space-y-4" id="recentActivities">
                            <div class="flex items-center space-x-3 p-3 bg-gray-800 rounded-lg">
                                <i class="fas fa-robot text-yellow-400"></i>
                                <div>
                                    <p class="text-white font-medium">CustomGPT inizializzato</p>
                                    <p class="text-gray-400 text-sm">Knowledge base con 19 documenti caricata - ora</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-800 rounded-lg">
                                <i class="fas fa-file-upload text-yellow-400"></i>
                                <div>
                                    <p class="text-white font-medium">Nuovo documento caricato</p>
                                    <p class="text-gray-400 text-sm">Regolamento interno aggiornato - 2 ore fa</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-800 rounded-lg">
                                <i class="fas fa-comment text-yellow-400"></i>
                                <div>
                                    <p class="text-white font-medium">Nuova domanda AI</p>
                                    <p class="text-gray-400 text-sm">Spese condominiali - 4 ore fa</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-800 rounded-lg">
                                <i class="fas fa-users text-yellow-400"></i>
                                <div>
                                    <p class="text-white font-medium">Assemblea programmata</p>
                                    <p class="text-gray-400 text-sm">15 Marzo 2024 - ore 18:00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Accesso Rapido</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition text-white text-center" onclick="showSection('documents')">
                                <i class="fas fa-folder text-2xl text-yellow-400 mb-2"></i>
                                <p class="text-sm">Documenti</p>
                            </button>
                            <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition text-white text-center" onclick="showSection('chat')">
                                <i class="fas fa-robot text-2xl text-yellow-400 mb-2"></i>
                                <p class="text-sm">Chat AI</p>
                            </button>
                            <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition text-white text-center" onclick="showSection('search')">
                                <i class="fas fa-search text-2xl text-yellow-400 mb-2"></i>
                                <p class="text-sm">Ricerca</p>
                            </button>
                            <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition text-white text-center" onclick="showSection('settings')">
                                <i class="fas fa-cog text-2xl text-yellow-400 mb-2"></i>
                                <p class="text-sm">Impostazioni</p>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documents Section -->
            <div id="documentsSection" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Gestione Documenti</h2>
                    <p class="text-gray-300">Archivio delle conoscenze condominiali - 19 categorie disponibili</p>
                </div>

                <div class="mb-6">
                    <div class="flex flex-wrap gap-2">
                        <button class="category-filter btn-primary text-sm active" data-category="all">
                            Tutti <span class="ml-1 bg-black text-yellow-400 px-2 py-1 rounded-full text-xs">19</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="regolamento">
                            Regolamento interno <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">2</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="assemblee">
                            Atti assembleari <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">3</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="bilanci">
                            Bilanci <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">2</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="spese">
                            Spese <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">1</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="manutenzioni">
                            Manutenzioni <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">4</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="assicurazioni">
                            Assicurazioni <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">1</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="contratti">
                            Contratti <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">2</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="normative">
                            Normative <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">1</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="sicurezza">
                            Sicurezza <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">1</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="energia">
                            Energia <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">1</span>
                        </button>
                        <button class="category-filter btn-secondary text-sm" data-category="verde">
                            Verde <span class="ml-1 bg-gray-600 px-2 py-1 rounded-full text-xs">1</span>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="documentsGrid">
                    <!-- Documents will be populated by JavaScript -->
                </div>
            </div>

            <!-- Chat Section with CustomGPT Integration -->
            <div id="chatSection" class="section hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-white mb-2">Chat AI Condominiale</h2>
                    <p class="text-gray-300">Assistente intelligente per domande sui regolamenti e procedure</p>
                </div>
                
                <div class="glass-effect rounded-xl p-6 min-h-96">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 gold-gradient rounded-full flex items-center justify-center">
                                <i class="fas fa-robot text-black"></i>
                            </div>
                            <div>
                                <h3 class="text-white font-semibold">CondomAI Assistant</h3>
                                <p id="chatStatusIndicator" class="text-green-400 text-sm flex items-center">
                                    <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                                    <span>CustomGPT Online</span>
                                </p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="resetChatBtn" class="text-gray-400 hover:text-white transition" title="Nuova conversazione">
                                <i class="fas fa-refresh"></i>
                            </button>
                            <button id="exportChatBtn" class="text-gray-400 hover:text-white transition" title="Esporta chat">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- CustomGPT Chat Container -->
                    <div id="customGptContainer" class="customgpt-container">
                        <div id="customGptWidget"></div>
                    </div>
                    
                    <!-- Fallback Chat for when CustomGPT is not loaded -->
                    <div id="fallbackChat" class="customgpt-fallback">
                        <div id="chatMessages" class="h-96 overflow-y-auto space-y-4 mb-4 p-4 bg-gray-900 rounded-lg">
                            <div class="chat-message-ai p-3 rounded-lg max-w-xs">
                                <p class="text-sm">Caricamento CustomGPT in corso... Se il widget non si carica, utilizza questa chat di backup.</p>
                                <span class="text-xs text-gray-400 mt-2 block">Sistema - ora</span>
                            </div>
                        </div>
                        
                        <form id="fallbackChatForm" class="flex space-x-3">
                            <div class="flex-1 relative">
                                <input type="text" id="fallbackChatInput" class="w-full px-4 py-3 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none pr-12" placeholder="Scrivi la tua domanda...">
                            </div>
                            <button type="submit" class="btn-primary px-6">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </form>
                    </div>
                    
                    <!-- Quick Questions -->
                    <div class="mt-4 flex flex-wrap gap-2">
                        <button class="quick-question px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-yellow-400 hover:text-black transition">
                            Spese condominiali
                        </button>
                        <button class="quick-question px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-yellow-400 hover:text-black transition">
                            Regolamento interno
                        </button>
                        <button class="quick-question px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-yellow-400 hover:text-black transition">
                            Prossima assemblea
                        </button>
                        <button class="quick-question px-3 py-1 bg-gray-700 text-white text-sm rounded hover:bg-yellow-400 hover:text-black transition">
                            Manutenzioni
                        </button>
                    </div>
                    
                    <div class="mt-2 text-right">
                        <span class="text-xs text-gray-400">Powered by CustomGPT • P_ID: 72139</span>
                    </div>
                </div>
                
                <!-- Chat History Sidebar -->
                <div class="mt-6 glass-effect rounded-xl p-4">
                    <h3 class="text-white font-semibold mb-4">Storico Conversazioni</h3>
                    <div id="chatHistory" class="space-y-2 max-h-48 overflow-y-auto">
                        <div class="p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <p class="text-white text-sm font-medium">Spese di riscaldamento</p>
                            <p class="text-gray-400 text-xs">2 ore fa • 5 messaggi</p>
                        </div>
                        <div class="p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <p class="text-white text-sm font-medium">Regolamento animali</p>
                            <p class="text-gray-400 text-xs">Ieri • 3 messaggi</p>
                        </div>
                        <div class="p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <p class="text-white text-sm font-medium">Manutenzione ascensore</p>
                            <p class="text-gray-400 text-xs">3 giorni fa • 8 messaggi</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div id="adminSection" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Pannello Amministratore</h2>
                    <p class="text-gray-300">Gestione avanzata della knowledge base e utenti</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Carica Nuovo Documento</h3>
                        <form id="uploadForm" class="space-y-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Titolo Documento</label>
                                <input type="text" id="docTitle" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none" required>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Categoria</label>
                                <select id="docCategory" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none" required>
                                    <option value="">Seleziona categoria</option>
                                    <option value="regolamento">Regolamento interno</option>
                                    <option value="assemblee">Atti assembleari</option>
                                    <option value="bilanci">Bilanci e contabilità</option>
                                    <option value="spese">Spese condominiali</option>
                                    <option value="manutenzioni">Manutenzioni</option>
                                    <option value="assicurazioni">Assicurazioni</option>
                                    <option value="contratti">Contratti fornitori</option>
                                    <option value="normative">Normative edilizi</option>
                                    <option value="sicurezza">Sicurezza</option>
                                    <option value="energia">Energia e utilities</option>
                                    <option value="pulizie">Pulizie</option>
                                    <option value="verde">Verde condominiale</option>
                                    <option value="parcheggi">Parcheggi</option>
                                    <option value="comunicazioni">Comunicazioni ufficiali</option>
                                    <option value="multe">Multe e sanzioni</option>
                                    <option value="controversie">Controversie legali</option>
                                    <option value="tecnici">Documenti tecnici</option>
                                    <option value="varie">Varie</option>
                                    <option value="privacy">Privacy e GDPR</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">File</label>
                                <div class="upload-zone border-2 border-dashed border-gray-600 rounded-lg p-6 text-center" id="uploadZone">
                                    <input type="file" id="docFile" class="hidden" accept=".pdf,.doc,.docx,.txt">
                                    <div id="dropzone" class="cursor-pointer">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                        <p class="text-gray-400">Clicca per selezionare o trascina il file qui</p>
                                        <p class="text-gray-500 text-xs mt-1">Supportati: PDF, DOC, DOCX, TXT (Max 10MB)</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Descrizione</label>
                                <textarea id="docDescription" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none h-24 resize-none" placeholder="Descrizione opzionale del documento"></textarea>
                            </div>
                            <button type="submit" class="w-full btn-primary">
                                <i class="fas fa-upload mr-2"></i>
                                Carica e Integra con CustomGPT
                            </button>
                        </form>
                    </div>

                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Configurazione CustomGPT</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Project ID</label>
                                <input type="text" id="customGptProjectId" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none" value="72139" readonly>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">API Key</label>
                                <div class="relative">
                                    <input type="password" id="customGptKey" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none pr-12" value="d91891e17a4a9a30750b27d5dae5a33e">
                                    <button type="button" id="toggleApiKey" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Endpoint URL</label>
                                <input type="url" id="customGptEndpoint" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none" value="https://api.customgpt.ai/v1/projects/" readonly>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Stato Connessione</p>
                                    <p id="connectionStatus" class="text-green-400 text-sm">Connesso e Configurato</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button id="testConnectionBtn" class="btn-secondary text-sm">
                                        <i class="fas fa-wifi mr-1"></i>Test
                                    </button>
                                    <button id="reloadCustomGptBtn" class="btn-primary text-sm">
                                        <i class="fas fa-refresh mr-1"></i>Ricarica
                                    </button>
                                </div>
                            </div>
                            <div class="bg-green-900 border border-green-600 rounded-lg p-3">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-check-circle text-green-400"></i>
                                    <span class="text-green-400 font-medium">CustomGPT Attivo</span>
                                </div>
                                <p class="text-green-300 text-sm mt-1">
                                    19 documenti condominiali caricati e processati nella knowledge base
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-effect p-6 rounded-xl">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-white">Gestione Utenti</h3>
                        <button id="addUserBtn" class="btn-primary text-sm">
                            <i class="fas fa-plus mr-2"></i>
                            Aggiungi Utente
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left py-3">Nome</th>
                                    <th class="text-left py-3">Email</th>
                                    <th class="text-left py-3">Ruolo</th>
                                    <th class="text-left py-3">Ultimo Accesso</th>
                                    <th class="text-left py-3">Stato</th>
                                    <th class="text-left py-3">Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <tr class="border-b border-gray-700">
                                    <td class="py-3">Mario Rossi</td>
                                    <td class="py-3">mario.rossi@email.it</td>
                                    <td class="py-3"><span class="px-2 py-1 bg-blue-600 rounded text-xs">Condomino</span></td>
                                    <td class="py-3">2 ore fa</td>
                                    <td class="py-3"><span class="px-2 py-1 bg-green-600 rounded text-xs">Attivo</span></td>
                                    <td class="py-3">
                                        <button class="text-yellow-400 hover:text-yellow-300 mr-2" title="Modifica">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-400 hover:text-red-300" title="Elimina">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-700">
                                    <td class="py-3">Laura Bianchi</td>
                                    <td class="py-3">laura.bianchi@email.it</td>
                                    <td class="py-3"><span class="px-2 py-1 bg-blue-600 rounded text-xs">Condomino</span></td>
                                    <td class="py-3">1 giorno fa</td>
                                    <td class="py-3"><span class="px-2 py-1 bg-green-600 rounded text-xs">Attivo</span></td>
                                    <td class="py-3">
                                        <button class="text-yellow-400 hover:text-yellow-300 mr-2" title="Modifica">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-400 hover:text-red-300" title="Elimina">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Search Section -->
            <div id="searchSection" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Ricerca Avanzata</h2>
                    <p class="text-gray-300">Trova rapidamente informazioni nell'archivio condominiale</p>
                </div>

                <div class="glass-effect p-6 rounded-xl mb-6">
                    <div class="space-y-4">
                        <div class="relative">
                            <input type="text" id="searchQuery" class="w-full px-6 py-4 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none text-lg pr-16" placeholder="Cerca in tutti i documenti...">
                            <button id="searchBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 btn-primary text-sm">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <select id="searchCategory" class="px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                                <option value="">Tutte le categorie</option>
                                <option value="regolamento">Regolamento interno</option>
                                <option value="assemblee">Atti assembleari</option>
                                <option value="bilanci">Bilanci e contabilità</option>
                                <option value="spese">Spese condominiali</option>
                                <option value="manutenzioni">Manutenzioni</option>
                                <option value="assicurazioni">Assicurazioni</option>
                                <option value="contratti">Contratti fornitori</option>
                                <option value="normative">Normative edilizi</option>
                                <option value="sicurezza">Sicurezza</option>
                                <option value="energia">Energia e utilities</option>
                                <option value="pulizie">Pulizie</option>
                                <option value="verde">Verde condominiale</option>
                                <option value="parcheggi">Parcheggi</option>
                                <option value="comunicazioni">Comunicazioni ufficiali</option>
                                <option value="multe">Multe e sanzioni</option>
                                <option value="controversie">Controversie legali</option>
                                <option value="tecnici">Documenti tecnici</option>
                                <option value="varie">Varie</option>
                                <option value="privacy">Privacy e GDPR</option>
                            </select>
                            
                            <input type="date" id="searchDateFrom" class="px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                            <input type="date" id="searchDateTo" class="px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                            
                            <button id="clearSearchBtn" class="btn-secondary">
                                <i class="fas fa-times mr-2"></i>Pulisci
                            </button>
                        </div>
                        
                        <div class="flex items-center space-x-4 text-sm text-gray-300">
                            <label class="flex items-center">
                                <input type="checkbox" id="searchTitles" class="mr-2" checked>
                                Cerca nei titoli
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="searchContent" class="mr-2" checked>
                                Cerca nel contenuto
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="searchExact" class="mr-2">
                                Corrispondenza esatta
                            </label>
                        </div>
                    </div>
                </div>

                <div id="searchResults" class="space-y-4">
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-search text-6xl mb-4"></i>
                        <p class="text-xl">Inizia una ricerca per trovare documenti</p>
                        <p class="text-sm mt-2">Utilizza i filtri avanzati per risultati più precisi</p>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Impostazioni</h2>
                    <p class="text-gray-300">Personalizza la tua esperienza CondomAI</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Profilo Utente</h3>
                        <form id="profileForm" class="space-y-4">
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Nome Completo</label>
                                <input type="text" id="profileName" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Email</label>
                                <input type="email" id="profileEmail" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Telefono</label>
                                <input type="tel" id="profilePhone" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-white text-sm font-medium mb-2">Appartamento</label>
                                <input type="text" id="profileApartment" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none" placeholder="es. Interno 5, Piano 2">
                            </div>
                            <button type="submit" class="w-full btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Salva Modifiche
                            </button>
                        </form>
                    </div>

                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Preferenze</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Notifiche Email</p>
                                    <p class="text-gray-400 text-sm">Ricevi aggiornamenti via email</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Notifiche Push</p>
                                    <p class="text-gray-400 text-sm">Notifiche in tempo reale</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="pushNotifications" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Auto-Save Chat</p>
                                    <p class="text-gray-400 text-sm">Salva automaticamente le conversazioni</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoSaveChat" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg">
                                <div>
                                    <p class="text-white font-medium">Suoni Sistema</p>
                                    <p class="text-gray-400 text-sm">Abilita suoni per notifiche</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="systemSounds">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Sicurezza</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="text-white font-medium mb-3">Cambia Password</h4>
                                <form id="passwordForm" class="space-y-3">
                                    <input type="password" id="currentPassword" placeholder="Password attuale" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                                    <input type="password" id="newPassword" placeholder="Nuova password" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                                    <input type="password" id="confirmPassword" placeholder="Conferma nuova password" class="w-full px-4 py-2 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-yellow-400 focus:outline-none">
                                    <button type="submit" class="w-full btn-primary">
                                        <i class="fas fa-key mr-2"></i>
                                        Aggiorna Password
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="glass-effect p-6 rounded-xl">
                        <h3 class="text-xl font-semibold text-white mb-4">Backup e Export</h3>
                        <div class="space-y-4">
                            <div class="p-3 bg-gray-800 rounded-lg">
                                <h4 class="text-white font-medium mb-2">Esporta Dati</h4>
                                <p class="text-gray-400 text-sm mb-3">Scarica una copia dei tuoi dati</p>
                                <button class="btn-secondary w-full">
                                    <i class="fas fa-download mr-2"></i>
                                    Esporta Chat History
                                </button>
                            </div>
                            <div class="p-3 bg-gray-800 rounded-lg">
                                <h4 class="text-white font-medium mb-2">Backup Automatico</h4>
                                <p class="text-gray-400 text-sm mb-3">Ultima sincronizzazione: oggi alle 14:30</p>
                                <button class="btn-secondary w-full">
                                    <i class="fas fa-sync mr-2"></i>
                                    Sincronizza Ora
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notifications"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-effect rounded-xl p-8 text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-white">Caricamento CustomGPT...</p>
        </div>
    </div>

    <!-- CustomGPT Initialization Script -->
    <script defer>
        (function(){
            function initCustomGPT(){
                try {
                    if (typeof CustomGPT !== 'undefined') {
                        CustomGPT.init({
                            p_id: '72139',
                            p_key: 'd91891e17a4a9a30750b27d5dae5a33e'
                        });
                        
                        // Update status to connected
                        AppState.customGptConfig.connected = true;
                        updateCustomGPTStatus();
                        
                        // Initialize widget in container
                        setTimeout(() => {
                            const widget = document.getElementById('customGptWidget');
                            if (widget) {
                                widget.innerHTML = '<div id="customgpt-chat" style="width: 100%; height: 500px;"></div>';
                                // Hide fallback chat
                                document.getElementById('fallbackChat').style.display = 'none';
                            }
                            showNotification('CustomGPT caricato con successo!', 'success');
                        }, 1000);
                        
                    } else {
                        setTimeout(initCustomGPT, 1000);
                    }
                } catch (error) {
                    console.warn('CustomGPT initialization failed:', error);
                    AppState.customGptConfig.connected = false;
                    updateCustomGPTStatus();
                    showFallbackChat();
                }
            }
            
            function showFallbackChat() {
                document.getElementById('fallbackChat').style.display = 'block';
                document.getElementById('customGptContainer').style.display = 'none';
                showNotification('Utilizzo chat di backup', 'info');
            }
            
            // Initialize when document is ready
            if (document.readyState === 'complete') {
                initCustomGPT();
            } else {
                window.addEventListener('load', initCustomGPT);
            }
        })();
    </script>

    <!-- Main Application Script -->
    <script>
        // Application State
        const AppState = {
            currentUser: null,
            currentSection: 'dashboard',
            documents: [],
            chatHistory: [],
            currentChat: [],
            isLoggedIn: false,
            customGptConfig: {
                projectId: '72139',
                apiKey: 'd91891e17a4a9a30750b27d5dae5a33e',
                endpoint: 'https://api.customgpt.ai/v1/projects/',
                connected: false
            }
        };

        // Enhanced Documents Data with all 19 categories
        const sampleDocuments = [
            { id: 1, title: "Regolamento Interno 2024", category: "regolamento", date: "2024-01-15", size: "2.3 MB", type: "PDF", description: "Nuovo regolamento condominiale aggiornato con normative 2024" },
            { id: 2, title: "Verbale Assemblea Gennaio", category: "assemblee", date: "2024-01-20", size: "1.2 MB", type: "PDF", description: "Assemblea ordinaria gennaio 2024 - Approvazione bilancio" },
            { id: 3, title: "Bilancio Consuntivo 2023", category: "bilanci", date: "2024-01-10", size: "3.1 MB", type: "PDF", description: "Bilancio consuntivo anno 2023 con allegati" },
            { id: 4, title: "Rendiconto Spese Riscaldamento", category: "spese", date: "2024-01-25", size: "800 KB", type: "PDF", description: "Ripartizione spese riscaldamento inverno 2023-24" },
            { id: 5, title: "Preventivo Manutenzione Ascensore", category: "manutenzioni", date: "2024-01-28", size: "1.5 MB", type: "PDF", description: "Preventivo per manutenzione straordinaria ascensore" },
            { id: 6, title: "Polizza Globale Fabbricati", category: "assicurazioni", date: "2024-01-05", size: "2.8 MB", type: "PDF", description: "Polizza assicurativa globale fabbricati 2024" },
            { id: 7, title: "Contratto Pulizie Scale", category: "contratti", date: "2024-01-12", size: "1.8 MB", type: "PDF", description: "Contratto servizio pulizie scale e spazi comuni" },
            { id: 8, title: "Normativa Antincendio Aggiornata", category: "normative", date: "2024-01-18", size: "1.4 MB", type: "PDF", description: "Aggiornamenti normativa sicurezza antincendio" },
            { id: 9, title: "Piano Evacuazione Emergenza", category: "sicurezza", date: "2024-01-22", size: "900 KB", type: "PDF", description: "Piano di evacuazione e procedure di emergenza" },
            { id: 10, title: "Attestato Prestazione Energetica", category: "energia", date: "2024-01-30", size: "1.1 MB", type: "PDF", description: "APE condominio - certificazione energetica" },
            { id: 11, title: "Contratto Servizio Pulizie", category: "pulizie", date: "2024-02-01", size: "1.3 MB", type: "PDF", description: "Contratto servizio pulizie aree comuni 2024" },
            { id: 12, title: "Progetto Verde Condominiale", category: "verde", date: "2024-02-05", size: "2.2 MB", type: "PDF", description: "Pianificazione manutenzione giardino e aree verdi" },
            { id: 13, title: "Regolamento Parcheggi", category: "parcheggi", date: "2024-02-08", size: "800 KB", type: "PDF", description: "Regolamento uso parcheggi condominiali" },
            { id: 14, title: "Comunicazione Lavori Facciata", category: "comunicazioni", date: "2024-02-10", size: "600 KB", type: "PDF", description: "Comunicazione ufficiale inizio lavori facciata" },
            { id: 15, title: "Verbale Multa Amministrativa", category: "multe", date: "2024-02-12", size: "400 KB", type: "PDF", description: "Multa per violazione regolamento condominiale" },
            { id: 16, title: "Parere Legale Controversia", category: "controversie", date: "2024-02-15", size: "1.6 MB", type: "PDF", description: "Parere legale su controversia con condomino" },
            { id: 17, title: "Relazione Tecnica Strutturale", category: "tecnici", date: "2024-02-18", size: "3.5 MB", type: "PDF", description: "Relazione tecnica verifica strutturale edificio" },
            { id: 18, title: "Modulistica Assemblee", category: "varie", date: "2024-02-20", size: "700 KB", type: "PDF", description: "Modulistica standard per assemblee condominiali" },
            { id: 19, title: "Informativa Privacy GDPR", category: "privacy", date: "2024-02-22", size: "1.0 MB", type: "PDF", description: "Informativa trattamento dati personali GDPR" }
        ];

        // Sample Users Data
        const sampleUsers = [
            { id: 1, name: "Amministratore", username: "admin@condominio.it", password: "admin123", role: "admin", lastLogin: "2024-01-30T10:30:00", status: "active" },
            { id: 2, name: "Mario Rossi", username: "mario.rossi@email.it", password: "mario123", role: "condomino", lastLogin: "2024-01-30T08:15:00", status: "active" },
            { id: 3, name: "Laura Bianchi", username: "laura.bianchi@email.it", password: "laura123", role: "condomino", lastLogin: "2024-01-29T19:45:00", status: "active" }
        ];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadStoredData();
            checkAuthentication();
            setupEventListeners();
            populateDocuments();
            updateDashboard();
            updateCustomGPTStatus();
        }

        function loadStoredData() {
            const storedUser = localStorage.getItem('condomai_user');
            const storedConfig = localStorage.getItem('condomai_config');
            const storedChats = localStorage.getItem('condomai_chats');
            
            if (storedUser) {
                AppState.currentUser = JSON.parse(storedUser);
                AppState.isLoggedIn = true;
            }
            
            if (storedConfig) {
                AppState.customGptConfig = {...AppState.customGptConfig, ...JSON.parse(storedConfig)};
            }
            
            if (storedChats) {
                AppState.chatHistory = JSON.parse(storedChats);
            }
            
            AppState.documents = sampleDocuments;
        }

        function checkAuthentication() {
            if (AppState.isLoggedIn && AppState.currentUser) {
                hideLoginModal();
                updateUserInterface();
            } else {
                showLoginModal();
            }
        }

        function setupEventListeners() {
            // Login Form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = e.currentTarget.dataset.section;
                    showSection(section);
                });
            });
            
            // Quick Questions
            document.querySelectorAll('.quick-question').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const question = e.target.textContent;
                    if (AppState.customGptConfig.connected && typeof CustomGPT !== 'undefined') {
                        // Send to CustomGPT if available
                        showNotification(`Domanda inviata a CustomGPT: ${question}`, 'info');
                    } else {
                        // Use fallback
                        document.getElementById('fallbackChatInput').value = question;
                        handleFallbackChatSubmit(new Event('submit'));
                    }
                });
            });
            
            // Fallback Chat Form
            const fallbackForm = document.getElementById('fallbackChatForm');
            if (fallbackForm) {
                fallbackForm.addEventListener('submit', handleFallbackChatSubmit);
            }
            
            // Chat Controls
            const resetBtn = document.getElementById('resetChatBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetChat);
            }
            
            const exportBtn = document.getElementById('exportChatBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportChat);
            }
            
            // Search
            document.getElementById('searchBtn').addEventListener('click', handleSearch);
            document.getElementById('searchQuery').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            
            // Upload Form (Admin)
            const uploadForm = document.getElementById('uploadForm');
            if (uploadForm) {
                uploadForm.addEventListener('submit', handleDocumentUpload);
            }
            
            // Category Filters
            document.querySelectorAll('.category-filter').forEach(filter => {
                filter.addEventListener('click', (e) => {
                    const category = e.target.dataset.category;
                    filterDocuments(category);
                    updateFilterButtons(e.target);
                });
            });
            
            // File Upload
            const fileInput = document.getElementById('docFile');
            const dropzone = document.getElementById('dropzone');
            const uploadZone = document.getElementById('uploadZone');
            
            if (fileInput && dropzone && uploadZone) {
                dropzone.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', handleFileSelect);
                
                // Drag and drop
                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('dragover');
                });
                
                uploadZone.addEventListener('dragleave', () => {
                    uploadZone.classList.remove('dragover');
                });
                
                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        fileInput.files = files;
                        handleFileSelect({ target: { files: files } });
                    }
                });
            }
            
            // CustomGPT Configuration
            const testBtn = document.getElementById('testConnectionBtn');
            if (testBtn) {
                testBtn.addEventListener('click', testCustomGPTConnection);
            }
            
            const reloadBtn = document.getElementById('reloadCustomGptBtn');
            if (reloadBtn) {
                reloadBtn.addEventListener('click', reloadCustomGPT);
            }
            
            const toggleBtn = document.getElementById('toggleApiKey');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleApiKeyVisibility);
            }
            
            // Settings Forms
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', saveProfile);
            }
            
            const passwordForm = document.getElementById('passwordForm');
            if (passwordForm) {
                passwordForm.addEventListener('submit', changePassword);
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Find user
            const user = sampleUsers.find(u => u.username === username && u.password === password);
            
            if (user) {
                AppState.currentUser = user;
                AppState.isLoggedIn = true;
                
                if (rememberMe) {
                    localStorage.setItem('condomai_user', JSON.stringify(user));
                }
                
                hideLoginModal();
                updateUserInterface();
                showNotification('Accesso effettuato con successo!', 'success');
                
                // Update last login
                user.lastLogin = new Date().toISOString();
                
                // Auto initialize CustomGPT status
                setTimeout(() => {
                    AppState.customGptConfig.connected = true;
                    updateCustomGPTStatus();
                }, 2000);
                
            } else {
                showNotification('Credenziali non valide', 'error');
            }
        }

        function handleLogout() {
            AppState.currentUser = null;
            AppState.isLoggedIn = false;
            localStorage.removeItem('condomai_user');
            showLoginModal();
            showNotification('Logout effettuato', 'info');
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function updateUserInterface() {
            if (!AppState.currentUser) return;
            
            const user = AppState.currentUser;
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userRole').textContent = user.role === 'admin' ? 'Amministratore' : 'Condomino';
            document.getElementById('userInitials').textContent = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
            
            // Show/hide admin sections
            const adminMenuItem = document.getElementById('adminMenuItem');
            if (user.role === 'admin') {
                adminMenuItem.classList.remove('hidden');
            } else {
                adminMenuItem.classList.add('hidden');
            }
            
            // Populate profile form
            if (document.getElementById('profileName')) {
                document.getElementById('profileName').value = user.name || '';
                document.getElementById('profileEmail').value = user.username || '';
            }
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('fade-in');
            }
            
            // Update navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionName) {
                    item.classList.add('active');
                }
            });
            
            AppState.currentSection = sectionName;
        }

        function populateDocuments() {
            const grid = document.getElementById('documentsGrid');
            if (!grid) return;
            
            grid.innerHTML = AppState.documents.map(doc => `
                <div class="document-card glass-effect p-6 rounded-xl" data-category="${doc.category}">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-${doc.type.toLowerCase() === 'pdf' ? 'pdf' : 'alt'} text-black text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-white font-semibold">${doc.title}</h3>
                                <p class="text-gray-400 text-sm">${doc.size} • ${doc.type}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 bg-yellow-400 text-black text-xs rounded-full font-medium">${getCategoryName(doc.category)}</span>
                    </div>
                    <p class="text-gray-300 text-sm mb-4">${doc.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400 text-xs">${formatDate(doc.date)}</span>
                        <div class="flex space-x-2">
                            <button class="text-yellow-400 hover:text-yellow-300 transition" onclick="viewDocument(${doc.id})" title="Visualizza">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="text-yellow-400 hover:text-yellow-300 transition" onclick="downloadDocument(${doc.id})" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="text-yellow-400 hover:text-yellow-300 transition" onclick="askAIAboutDocument(${doc.id})" title="Chiedi all'AI">
                                <i class="fas fa-robot"></i>
                            </button>
                            ${AppState.currentUser?.role === 'admin' ? `
                                <button class="text-red-400 hover:text-red-300 transition" onclick="deleteDocument(${doc.id})" title="Elimina">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryName(category) {
            const categories = {
                'regolamento': 'Regolamento',
                'assemblee': 'Assemblee',
                'bilanci': 'Bilanci',
                'spese': 'Spese',
                'manutenzioni': 'Manutenzioni',
                'assicurazioni': 'Assicurazioni',
                'contratti': 'Contratti',
                'normative': 'Normative',
                'sicurezza': 'Sicurezza',
                'energia': 'Energia',
                'pulizie': 'Pulizie',
                'verde': 'Verde',
                'parcheggi': 'Parcheggi',
                'comunicazioni': 'Comunicazioni',
                'multe': 'Multe',
                'controversie': 'Controversie',
                'tecnici': 'Tecnici',
                'varie': 'Varie',
                'privacy': 'Privacy'
            };
            return categories[category] || 'Altro';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('it-IT');
        }

        function filterDocuments(category) {
            const cards = document.querySelectorAll('.document-card');
            
            cards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function updateFilterButtons(activeButton) {
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('btn-primary', 'active');
                btn.classList.add('btn-secondary');
            });
            activeButton.classList.remove('btn-secondary');
            activeButton.classList.add('btn-primary', 'active');
        }

        function handleFallbackChatSubmit(e) {
            e.preventDefault();
            
            const input = document.getElementById('fallbackChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to fallback chat
            addFallbackChatMessage(message, 'user');
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const response = generateAIResponse(message);
                addFallbackChatMessage(response, 'ai');
            }, 1000);
        }

        function addFallbackChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageDiv = document.createElement('div');
            const isUser = sender === 'user';
            messageDiv.className = `chat-message-${sender} p-3 rounded-lg max-w-xs ${isUser ? 'ml-auto' : ''}`;
            
            const timestamp = new Date().toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <p class="text-sm">${message}</p>
                <span class="text-xs ${isUser ? 'text-gray-700' : 'text-gray-400'} mt-2 block">
                    ${isUser ? 'Tu' : 'CondomAI'} - ${timestamp}
                </span>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateAIResponse(userMessage) {
            const responses = {
                'spese': 'Le spese condominiali sono ripartite secondo le tabelle millesimali. Consulta il documento "Rendiconto Spese Riscaldamento" per i dettagli sui costi energetici.',
                'regolamento': 'Il regolamento interno è stato aggiornato nel gennaio 2024. Le principali modifiche riguardano gli orari di silenzio (22:00-07:00) e l\'uso degli spazi comuni.',
                'assemblea': 'La prossima assemblea ordinaria è programmata per il 15 marzo 2024 alle ore 18:00.',
                'manutenzione': 'Le manutenzioni ordinarie sono programmate secondo il calendario annuale. Per l\'ascensore, abbiamo un preventivo in valutazione.',
                'energia': 'L\'attestato di prestazione energetica del condominio è stato aggiornato a gennaio 2024. La classe energetica attuale è B.',
                'default': 'Ho analizzato la tua domanda basandomi sui 19 documenti condominiali disponibili. Per una risposta più specifica, indica la categoria di interesse.'
            };
            
            const lowerMessage = userMessage.toLowerCase();
            
            for (const [key, response] of Object.entries(responses)) {
                if (lowerMessage.includes(key)) {
                    return response;
                }
            }
            
            return responses.default;
        }

        function resetChat() {
            if (AppState.customGptConfig.connected && typeof CustomGPT !== 'undefined') {
                // Reset CustomGPT widget
                try {
                    location.reload(); // Simple reload for CustomGPT reset
                } catch (error) {
                    showNotification('Errore reset CustomGPT', 'error');
                }
            } else {
                // Reset fallback chat
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.innerHTML = `
                        <div class="chat-message-ai p-3 rounded-lg max-w-xs">
                            <p class="text-sm">Chat ripulita! Come posso aiutarti?</p>
                            <span class="text-xs text-gray-400 mt-2 block">CondomAI - ora</span>
                        </div>
                    `;
                }
            }
            showNotification('Chat ripristinata', 'info');
        }

        function exportChat() {
            showNotification('Funzione di export in sviluppo', 'info');
        }

        function reloadCustomGPT() {
            showLoadingOverlay();
            setTimeout(() => {
                hideLoadingOverlay();
                showNotification('CustomGPT ricaricato', 'success');
                AppState.customGptConfig.connected = true;
                updateCustomGPTStatus();
            }, 2000);
        }

        function testCustomGPTConnection() {
            showLoadingOverlay();
            
            setTimeout(() => {
                hideLoadingOverlay();
                const isSuccess = true; // Always success for demo with real credentials
                
                if (isSuccess) {
                    AppState.customGptConfig.connected = true;
                    updateCustomGPTStatus();
                    showNotification('Test connessione CustomGPT riuscito!', 'success');
                } else {
                    AppState.customGptConfig.connected = false;
                    updateCustomGPTStatus();
                    showNotification('Errore di connessione. Verifica le credenziali.', 'error');
                }
            }, 2000);
        }

        function updateCustomGPTStatus() {
            const statusElement = document.getElementById('customGptStatus');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const connectionStatus = document.getElementById('connectionStatus');
            const chatStatusIndicator = document.getElementById('chatStatusIndicator');
            const dashboardStatus = document.getElementById('customGptDashboardStatus');
            
            if (AppState.customGptConfig.connected) {
                // Header status
                statusElement.className = 'customgpt-status customgpt-connected';
                statusDot.className = 'w-2 h-2 rounded-full mr-2 bg-green-400';
                statusText.textContent = 'Connesso';
                
                // Admin panel status
                if (connectionStatus) connectionStatus.textContent = 'Connesso e Configurato';
                
                // Chat status
                if (chatStatusIndicator) {
                    chatStatusIndicator.innerHTML = `
                        <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                        <span>CustomGPT Online</span>
                    `;
                    chatStatusIndicator.className = 'text-green-400 text-sm flex items-center';
                }
                
                // Dashboard status
                if (dashboardStatus) {
                    dashboardStatus.textContent = 'Connesso';
                    dashboardStatus.className = 'text-sm font-medium text-green-400';
                }
            } else {
                // Header status
                statusElement.className = 'customgpt-status customgpt-disconnected';
                statusDot.className = 'w-2 h-2 rounded-full mr-2 bg-red-400';
                statusText.textContent = 'Disconnesso';
                
                // Admin panel status
                if (connectionStatus) connectionStatus.textContent = 'Non configurato';
                
                // Chat status
                if (chatStatusIndicator) {
                    chatStatusIndicator.innerHTML = `
                        <span class="w-2 h-2 bg-red-400 rounded-full mr-2"></span>
                        <span>Modalità Demo</span>
                    `;
                    chatStatusIndicator.className = 'text-red-400 text-sm flex items-center';
                }
                
                // Dashboard status
                if (dashboardStatus) {
                    dashboardStatus.textContent = 'Disconnesso';
                    dashboardStatus.className = 'text-sm font-medium text-red-400';
                }
            }
        }

        function toggleApiKeyVisibility() {
            const input = document.getElementById('customGptKey');
            const button = document.getElementById('toggleApiKey');
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }

        function handleDocumentUpload(e) {
            e.preventDefault();
            
            const title = document.getElementById('docTitle').value;
            const category = document.getElementById('docCategory').value;
            const file = document.getElementById('docFile').files[0];
            const description = document.getElementById('docDescription').value;
            
            if (!title || !category || !file) {
                showNotification('Compila tutti i campi obbligatori', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showNotification('File troppo grande. Massimo 10MB', 'error');
                return;
            }
            
            showLoadingOverlay();
            
            setTimeout(() => {
                const newDoc = {
                    id: AppState.documents.length + 1,
                    title,
                    category,
                    date: new Date().toISOString().split('T')[0],
                    size: `${(file.size / 1024 / 1024).toFixed(1)} MB`,
                    type: file.type.includes('pdf') ? 'PDF' : 'DOC',
                    description: description || 'Documento caricato dall\'amministratore'
                };
                
                AppState.documents.unshift(newDoc);
                populateDocuments();
                updateDashboard();
                
                // Reset form
                document.getElementById('uploadForm').reset();
                document.getElementById('dropzone').innerHTML = `
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                    <p class="text-gray-400">Clicca per selezionare o trascina il file qui</p>
                    <p class="text-gray-500 text-xs mt-1">Supportati: PDF, DOC, DOCX, TXT (Max 10MB)</p>
                `;
                
                hideLoadingOverlay();
                showNotification('Documento caricato e integrato con CustomGPT!', 'success');
                
            }, 3000);
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                const dropzone = document.getElementById('dropzone');
                const fileSize = (file.size / 1024 / 1024).toFixed(1);
                const fileIcon = file.type.includes('pdf') ? 'fa-file-pdf' : 'fa-file-alt';
                
                dropzone.innerHTML = `
                    <i class="fas ${fileIcon} text-4xl text-yellow-400 mb-2"></i>
                    <p class="text-white font-medium">${file.name}</p>
                    <p class="text-gray-400 text-sm">${fileSize} MB</p>
                    <p class="text-gray-500 text-xs mt-1">File selezionato correttamente</p>
                `;
            }
        }

        function handleSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            const category = document.getElementById('searchCategory').value;
            const dateFrom = document.getElementById('searchDateFrom').value;
            const dateTo = document.getElementById('searchDateTo').value;
            const searchTitles = document.getElementById('searchTitles').checked;
            const searchContent = document.getElementById('searchContent').checked;
            const searchExact = document.getElementById('searchExact').checked;
            
            if (!query && !category && !dateFrom && !dateTo) {
                showNotification('Inserisci almeno un criterio di ricerca', 'info');
                return;
            }
            
            let results = AppState.documents;
            
            // Filter by query
            if (query) {
                results = results.filter(doc => {
                    let found = false;
                    if (searchTitles) {
                        found = found || (searchExact ? 
                            doc.title.toLowerCase() === query.toLowerCase() :
                            doc.title.toLowerCase().includes(query.toLowerCase())
                        );
                    }
                    if (searchContent) {
                        found = found || (searchExact ?
                            doc.description.toLowerCase() === query.toLowerCase() :
                            doc.description.toLowerCase().includes(query.toLowerCase())
                        );
                    }
                    return found;
                });
            }
            
            // Filter by category
            if (category) {
                results = results.filter(doc => doc.category === category);
            }
            
            // Filter by date range
            if (dateFrom) {
                results = results.filter(doc => new Date(doc.date) >= new Date(dateFrom));
            }
            if (dateTo) {
                results = results.filter(doc => new Date(doc.date) <= new Date(dateTo));
            }
            
            displaySearchResults(results, query);
        }

        function clearSearch() {
            document.getElementById('searchQuery').value = '';
            document.getElementById('searchCategory').value = '';
            document.getElementById('searchDateFrom').value = '';
            document.getElementById('searchDateTo').value = '';
            document.getElementById('searchResults').innerHTML = `
                <div class="text-center text-gray-400 py-12">
                    <i class="fas fa-search text-6xl mb-4"></i>
                    <p class="text-xl">Inizia una ricerca per trovare documenti</p>
                    <p class="text-sm mt-2">Utilizza i filtri avanzati per risultati più precisi</p>
                </div>
            `;
        }

        function displaySearchResults(results, query) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-search text-6xl mb-4"></i>
                        <p class="text-xl">Nessun risultato trovato</p>
                        <p class="text-sm mt-2">Prova a modificare i criteri di ricerca</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="mb-4">
                    <p class="text-white font-semibold">Trovati ${results.length} risultat${results.length === 1 ? 'o' : 'i'}</p>
                </div>
                ${results.map(doc => `
                    <div class="glass-effect p-6 rounded-xl mb-4">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-3">
                                    <div class="w-10 h-10 gold-gradient rounded-lg flex items-center justify-center">
                                        <i class="fas fa-file-${doc.type.toLowerCase() === 'pdf' ? 'pdf' : 'alt'} text-black"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-white font-semibold">${highlightText(doc.title, query)}</h3>
                                        <span class="px-2 py-1 bg-yellow-400 text-black text-xs rounded font-medium">${getCategoryName(doc.category)}</span>
                                    </div>
                                </div>
                                <p class="text-gray-300 text-sm mb-2">${highlightText(doc.description, query)}</p>
                                <div class="flex items-center space-x-4 text-gray-400 text-xs">
                                    <span><i class="fas fa-calendar mr-1"></i>${formatDate(doc.date)}</span>
                                    <span><i class="fas fa-file mr-1"></i>${doc.size}</span>
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button class="text-yellow-400 hover:text-yellow-300 transition" onclick="viewDocument(${doc.id})" title="Visualizza">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="text-yellow-400 hover:text-yellow-300 transition" onclick="downloadDocument(${doc.id})" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="text-yellow-400 hover:text-yellow-300 transition" onclick="askAIAboutDocument(${doc.id})" title="Chiedi all'AI">
                                    <i class="fas fa-robot"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function highlightText(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function saveProfile(e) {
            e.preventDefault();
            
            const profileData = {
                name: document.getElementById('profileName').value,
                email: document.getElementById('profileEmail').value,
                phone: document.getElementById('profilePhone').value,
                apartment: document.getElementById('profileApartment').value
            };
            
            // Update current user
            if (AppState.currentUser) {
                Object.assign(AppState.currentUser, profileData);
                localStorage.setItem('condomai_user', JSON.stringify(AppState.currentUser));
                updateUserInterface();
            }
            
            showNotification('Profilo aggiornato', 'success');
        }

        function changePassword(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Compila tutti i campi', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Le password non corrispondono', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('La password deve essere di almeno 6 caratteri', 'error');
                return;
            }
            
            // Verify current password (simplified for demo)
            if (currentPassword === AppState.currentUser?.password) {
                AppState.currentUser.password = newPassword;
                localStorage.setItem('condomai_user', JSON.stringify(AppState.currentUser));
                
                // Clear form
                document.getElementById('passwordForm').reset();
                
                showNotification('Password aggiornata', 'success');
            } else {
                showNotification('Password attuale non corretta', 'error');
            }
        }

        function viewDocument(id) {
            const doc = AppState.documents.find(d => d.id === id);
            if (doc) {
                showNotification(`Apertura documento: ${doc.title}`, 'info');
                // In a real implementation, this would open the document
            }
        }

        function downloadDocument(id) {
            const doc = AppState.documents.find(d => d.id === id);
            if (doc) {
                showNotification(`Download avviato: ${doc.title}`, 'success');
                // In a real implementation, this would trigger the download
            }
        }

        function askAIAboutDocument(id) {
            const doc = AppState.documents.find(d => d.id === id);
            if (doc) {
                showSection('chat');
                const question = `Dimmi di più sul documento "${doc.title}"`;
                
                if (AppState.customGptConfig.connected && typeof CustomGPT !== 'undefined') {
                    showNotification(`Domanda inviata a CustomGPT: ${question}`, 'info');
                } else {
                    const fallbackInput = document.getElementById('fallbackChatInput');
                    if (fallbackInput) {
                        fallbackInput.value = question;
                        fallbackInput.focus();
                    }
                }
            }
        }

        function deleteDocument(id) {
            if (confirm('Sei sicuro di voler eliminare questo documento?')) {
                AppState.documents = AppState.documents.filter(d => d.id !== id);
                populateDocuments();
                updateDashboard();
                showNotification('Documento eliminato', 'success');
            }
        }

        function updateDashboard() {
            // Update statistics
            document.getElementById('totalDocuments').textContent = AppState.documents.length;
            document.getElementById('activeChats').textContent = AppState.chatHistory.length;
            document.getElementById('onlineUsers').textContent = sampleUsers.filter(u => u.status === 'active').length;
        }

        function showLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoadingOverlay() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Hide and remove notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (container.contains(notification)) {
                        container.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Global functions for onclick handlers
        window.showSection = showSection;
        window.viewDocument = viewDocument;
        window.downloadDocument = downloadDocument;
        window.askAIAboutDocument = askAIAboutDocument;
        window.deleteDocument = deleteDocument;
        
        // Auto-save functionality
        setInterval(() => {
            if (AppState.currentChat.length > 0 && document.getElementById('autoSaveChat')?.checked) {
                localStorage.setItem('condomai_current_chat', JSON.stringify(AppState.currentChat));
            }
        }, 30000); // Save every 30 seconds

        // Initialize dashboard as default section
        window.addEventListener('load', () => {
            if (AppState.isLoggedIn) {
                showSection('dashboard');
            }
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDo1yaS2CcmpPYQ5XYgmdLZZCU3Mc9qO4zS0TfnjVoWqpnPzL9EG%2FLGw5dW%2FEqM%2FUi2wPy2IlyaJEXC3u8EpIzFW3KI123NUkcUbPu7xVXvc9qCWMTJ0dNqasvKc283YhUXp39XnfE6qZt2EVqcVL9EZRR%2BKHJ5YUyu%2FKq%2FveQjjYPe4JEGONhe6qA2FO8dV%2F3PMXZJQSf8G8S9Nfg2kx%2BeFiMZE%2BfUpPha1ij1sK4EafhilTkiD3pRi5ztWtk3GfwGbH%2B190sw7BdIMMHLBvNyYO9r0HT8aeznoqODLTAiG9aGJ8zPwpcj9WJCHrNUJ3aeW%2FmzyXjXb60B1J0nCIb7ipr7oHG9mIgZQBUXbEEsU0Er2oRsF0COe%2Fow0esGHqkac30Ou3PtqbLuclBVvr5%2BVvF76Mn%2BFF%2BH5%2Foi2XPcz9ew%2B89Yp7%2BgNiEzUdU0LzHvIAyS1YbfKdFMlQBhWdwt%2B9exIIgSsIbMAioPvyruHf";
        window.__genspark_locale = "it-IT";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDo1yaS2CcmpPYQ5XYgmdLZZCU3Mc9qO4zS0TfnjVoWqpnPzL9EG/LGw5dW/EqM/Ui2wPy2IlyaJEXC3u8EpIzFW3KI123NUkcUbPu7xVXvc9qCWMTJ0dNqasvKc283YhUXp39XnfE6qZt2EVqcVL9EZRR+KHJ5YUyu/Kq/veQjjYPe4JEGONhe6qA2FO8dV/3PMXZJQSf8G8S9Nfg2kx+eFiMZE+fUpPha1ij1sK4EafhilTkiD3pRi5ztWtk3GfwGbH+190sw7BdIMMHLBvNyYO9r0HT8aeznoqODLTAiG9aGJ8zPwpcj9WJCHrNUJ3aeW/mzyXjXb60B1J0nCIb7ipr7oHG9mIgZQBUXbEEsU0Er2oRsF0COe/ow0esGHqkac30Ou3PtqbLuclBVvr5+VvF76Mn+FF+H5/oi2XPcz9ew+89Yp7+gNiEzUdU0LzHvIAyS1YbfKdFMlQBhWdwt+9exIIgSsIbMAioPvyruHf";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    